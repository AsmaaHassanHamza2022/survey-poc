<!-- ...existing code... -->
<div class="designer-section d-flex flex-column gap-3 ">
    @for(page of formFieldsService.pages;track page.id;let pageIndex=$index) {
    <div class="card p-3 bg-light d-flex flex-column gap-3">
        <h3>{{page.title}}</h3>

        <!-- question list becomes a drop container -->
        <div cdkDropList [cdkDropListData]="page.questions" class="questions-list d-flex flex-column gap-3"
            (cdkDropListDropped)="onQuestionDrop($event, page)">
            @for(question of page.questions;track question.id) {
            <div cdkDrag [cdkDragData]="question"
                class="form-group bg-white p-3 border rounded-2 d-flex flex-column gap-3">
                <div class=" d-flex justify-content-end align-items-center gap-3">
                    <img src="icons/duplicate.svg" (click)="formFieldsService.duplicateQuestion(page.id, question)"
                        alt="duplicate-icon" />
                    <img (click)="formFieldsService.deleteQuestionFromPage(page.id, question.id)" src="icons/trash.svg"
                        alt="drag-icon" />
                    <img  class="drag-icon" src="icons/drag-icon.svg" alt="drag-icon" />
                    <img width="20" height="20" (click)="toggleCollapse(page.id,question.id)" [src]="question.isCollapsed ? 'icons/collapse.svg' :'icons/expand.svg'"/>
                </div>
                <ng-template cdkDragPreview>
                    <div class="drag-preview card p-3">
                        <strong>{{ question.questionText }}</strong>
                    </div>
                </ng-template>

                <!-- Placeholder left in the list while dragging -->
                <ng-template cdkDragPlaceholder>
                    <div class="drag-placeholder card p-3 border border-dashed">
                        &nbsp;
                    </div>
                </ng-template>
                <div class="row">
                    <div class="col-md-8">
                        <label class="mb-2" for="Question">Question
                            @if(question.isRequired){
                            <span class="is-required text-danger">*</span>
                            }
                        </label>
                        <input id="Question" [(ngModel)]="question.questionText" type="text" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label class="mb-2" for="QuestionType">Question Type</label>
                        <select class="form-select" [(ngModel)]="question.type"
                            (change)="formFieldsService.changeQuestionType(page.id, question.id,$any($event.target).value)">
                            @for(type of fieldsTypesService.getAllTypes();track
                            type.type) {
                            <option value="{{ type.type }}">{{ type.label }}</option>
                            }
                        </select>
                    </div>
                    <div class="col-12 mt-3">
                        <label class="mb-2" for="DescriptionText">Description</label>
                        <input id="DescriptionText" [(ngModel)]="question.descriptionText" type="text"
                            class="form-control" />
                    </div>
                </div>
                <div class="collapsed-content" [class.collapsed]="question.isCollapsed">
                <div class="row">
                    <app-form-field [question]="question" [isDesignMode]="true"></app-form-field>
                </div>
                <div class="row actions">
                    <div class="col-12 d-flex justify-content-end align-items-center gap-2">
                        <div class="form-check">
                            <input [(ngModel)]="question.isRequired" class="form-check-input" type="checkbox"
                                id="required-{{question.id}}">
                            <label class="form-check-label" for="required-{{question.id}}">
                                Is Required
                            </label>
                        </div>
                        <!-- <button (click)="formFieldsService.deleteQuestionFromPage(page.id, question.id)"
                            class="btn btn-danger">
                            Delete Question
                        </button> -->
                        <!-- <button (click)="formFieldsService.duplicateQuestion(page.id, question)"
                            class="btn btn-warning">
                            duplicate Question
                        </button> -->

                    </div>
                    <div class="col-12 mt-3">
                        <label>Show this question only if:</label>

                        <select class="form-select" [(ngModel)]="question.showIf.questionId"
                            (change)="changeRelatedQuestion(question)">
                            <option value="">Always show</option>

                            @for (q of formFieldsService.getAllQuestionsExcept(question.id); track q.id) {
                            <option value="{{q.id}}">{{q.questionText}}</option>
                            }
                        </select>

                        <div *ngIf="question.showIf.questionId">
                            <label class="mt-2">And answer is:</label>
                            <select class="form-select" [(ngModel)]="question.showIf.value">
                                <option value="">Choose option</option>

                                @for(option of relatedOptions; track option.value) {
                                <option value="{{option.value}}">{{option.label}}</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
               </div>
            </div>
            }@empty{
            <p class="text-center text-secondary">No Questions Added Yet</p>
            }
        </div>

        <div class="d-flex gap-3 justify-content-end">
            <button (click)="formFieldsService.addQuestionToPage(page.id)" class="btn btn-primary">
                Add New Question
            </button>
            @if(pageIndex == formFieldsService.pages.length -1){
            <button (click)="formFieldsService.addNewPage()" class="btn btn-primary">
                Add New Page
            </button>
            }
            <button (click)="formFieldsService.deletePage(page.id)" class="btn btn-danger">
                Delete Page
            </button>
        </div>
    </div>
    }

</div>
<!-- ...existing code... -->